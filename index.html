<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Real Vending Machine Decision</title>
<style>
    /* --- åŸºæœ¬è¨­å®š --- */
    :root {
        --machine-bg: #ecf0f1;
        --machine-shadow: #bdc3c7;
        --night-bg: #0b0c10;
        --light-on: #fffacd; /* è›å…‰ç¯ã®è‰² */
        --btn-off: #e74c3c;
        --btn-on: #ff7675;
        --btn-light: #ffeb3b;
    }

    * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
        user-select: none;
    }

    body {
        margin: 0;
        background-color: var(--night-bg);
        font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

    /* --- è‡ªè²©æ©Ÿæœ¬ä½“ --- */
    .vending-machine {
        width: 340px; /* ã‚¹ãƒãƒ›å¹…ã«åˆã‚ã›ã¤ã¤ãƒªã‚¢ãƒ«ãªæ¯”ç‡ */
        height: 600px;
        background: linear-gradient(to right, #dfe6e9, #f5f6fa 40%, #dfe6e9);
        border-radius: 10px;
        border: 2px solid #636e72;
        box-shadow: 0 0 50px rgba(255, 255, 255, 0.1), inset 0 0 20px rgba(0,0,0,0.2);
        display: flex;
        flex-direction: column;
        padding: 15px;
        position: relative;
    }

    /* ä¸Šéƒ¨ï¼šå•†å“ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ï¼ˆã‚¢ã‚¯ãƒªãƒ«æ¿ã®ä¸­ï¼‰ */
    .display-case {
        background: #2d3436;
        border-radius: 5px;
        padding: 10px;
        height: 280px;
        position: relative;
        box-shadow: inset 0 0 15px rgba(0,0,0,0.8);
        border: 4px solid #b2bec3;
        overflow: hidden;
    }

    /* è›å…‰ç¯ã®æ˜ ã‚Šè¾¼ã¿æ¼”å‡º */
    .display-case::after {
        content: "";
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 40%);
        pointer-events: none;
        z-index: 5;
    }

    .shelf {
        display: flex;
        justify-content: space-around;
        height: 100%;
        align-items: flex-end;
    }

    /* å•†å“ã‚¹ãƒ­ãƒƒãƒˆ */
    .product-slot {
        width: 45%;
        height: 90%;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        transition: transform 0.2s;
    }

    /* å•†å“ã®èƒŒæ™¯ï¼ˆãƒ©ã‚¤ãƒˆï¼‰ */
    .back-light {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 80%;
        background: rgba(255, 255, 255, 0.1); /* æ¶ˆç¯æ™‚ */
        border-radius: 5px;
        z-index: 1;
        box-shadow: 0 0 5px rgba(0,0,0,0.5);
        transition: background 0.1s, box-shadow 0.1s;
    }
    
    /* ç‚¹ç¯æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .product-slot.lit .back-light {
        background: var(--light-on);
        box-shadow: 0 0 20px var(--light-on);
    }

    /* å•†å“ç”»åƒï¼ˆç¼¶ãƒ»ãƒœãƒˆãƒ«ï¼‰ */
    .can-image {
        width: 80%;
        height: 75%;
        z-index: 2;
        object-fit: contain;
        filter: brightness(0.7); /* æ¶ˆç¯æ™‚ã¯æš—ã */
        transition: filter 0.1s;
    }
    .product-slot.lit .can-image {
        filter: brightness(1.1); /* ç‚¹ç¯æ™‚ã¯æ˜ã‚‹ã */
    }

    /* ä¾¡æ ¼ãƒ»å•†å“åãƒ©ãƒ™ãƒ« */
    .price-tag {
        z-index: 2;
        background: #e74c3c;
        color: white;
        padding: 2px 8px;
        font-size: 10px;
        border-radius: 3px;
        margin-top: 5px;
        font-weight: bold;
        box-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    .product-name {
        z-index: 2;
        color: white;
        font-size: 10px;
        margin-top: 2px;
        text-shadow: 1px 1px 2px black;
        text-align: center;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 100%;
    }

    /* ä¸­æ®µï¼šãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
    .control-panel {
        background: #b2bec3;
        margin-top: 10px;
        padding: 15px;
        border-radius: 5px;
        display: flex;
        justify-content: space-around;
        box-shadow: inset 0 1px 3px rgba(255,255,255,0.5), 0 2px 5px rgba(0,0,0,0.2);
    }

    /* è‡ªè²©æ©Ÿã®ç‰©ç†ãƒœã‚¿ãƒ³ */
    .machine-btn {
        width: 100px;
        height: 60px;
        background: linear-gradient(to bottom, #dcdde1, #b2bec3);
        border-radius: 50px; /* æ¥•å††å½¢ */
        border: 2px solid #636e72;
        position: relative;
        cursor: pointer;
        box-shadow: 0 4px 0 #7f8c8d, 0 5px 10px rgba(0,0,0,0.3);
        display: flex;
        justify-content: center;
        align-items: center;
        transition: top 0.1s, box-shadow 0.1s;
        top: 0;
    }

    /* ãƒœã‚¿ãƒ³ã®ä¸­ã®ãƒ©ãƒ³ãƒ—éƒ¨åˆ† */
    .btn-lamp {
        width: 80%;
        height: 60%;
        border-radius: 40px;
        background: #555; /* æ¶ˆç¯æ™‚ */
        border: 2px solid #333;
        display: flex;
        justify-content: center;
        align-items: center;
        color: rgba(255,255,255,0.2);
        font-size: 12px;
        font-weight: bold;
        box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
    }
    .btn-lamp::after {
        content: "ã¤ã‚ãŸã„";
        font-size: 0.8rem;
    }

    /* ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸè¦‹ãŸç›® */
    .machine-btn:active, .machine-btn.pressed {
        top: 4px;
        box-shadow: 0 0 0 #7f8c8d, inset 0 0 10px rgba(0,0,0,0.3);
    }

    /* ãƒ©ãƒ³ãƒ—ç‚¹ç¯ï¼ˆãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆä¸­ãƒ»é¸æŠä¸­ï¼‰ */
    .machine-btn.lit .btn-lamp {
        background: #3498db; /* é’ã„å…‰ */
        color: #fff;
        box-shadow: 0 0 10px #3498db, inset 0 0 5px rgba(255,255,255,0.5);
        text-shadow: 0 0 5px #fff;
    }

    /* ä¸‹éƒ¨ï¼šå–ã‚Šå‡ºã—å£ */
    .dispenser-port {
        margin-top: auto;
        height: 100px;
        background: #2d3436;
        border-radius: 5px;
        border-top: 5px solid #636e72;
        position: relative;
        overflow: hidden;
        box-shadow: inset 0 5px 15px rgba(0,0,0,0.8);
    }

    /* å–ã‚Šå‡ºã—å£ã®ãƒ•ãƒ©ãƒƒãƒ—ï¼ˆãƒ•ã‚¿ï¼‰ */
    .dispenser-flap {
        width: 100%;
        height: 80%;
        background: rgba(255,255,255,0.05);
        position: absolute;
        bottom: 0;
        transform-origin: top;
        border-top: 1px solid rgba(255,255,255,0.2);
    }

    /* è½ã¡ã¦ãã‚‹å•†å“ */
    .dropped-item {
        position: absolute;
        top: -150px; /* è¦‹ãˆãªã„ä½ç½® */
        left: 50%;
        transform: translateX(-50%) rotate(10deg);
        width: 100px;
        transition: top 0.5s cubic-bezier(0.5, 1.5, 0.5, 1);
        z-index: 10;
        filter: drop-shadow(5px 5px 10px rgba(0,0,0,0.5));
    }
    .dropped-item.drop {
        top: 15px; /* è½ã¡ãŸä½ç½® */
        transform: translateX(-50%) rotate(-85deg); /* ã‚³ãƒ­ãƒ³ã¨å¯è»¢ãŒã‚‹ */
    }
    .dropped-item img {
        width: 100%;
        height: auto;
    }

    /* è¨­å®šãƒœã‚¿ãƒ³ï¼ˆéš ã—ï¼‰ */
    .config-trigger {
        position: fixed;
        top: 10px; right: 10px;
        color: #333;
        background: #fff;
        border: none;
        padding: 5px 10px;
        opacity: 0.2;
        border-radius: 4px;
        font-size: 10px;
    }
    .config-trigger:hover { opacity: 1; }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal {
        display: none;
        position: fixed;
        top:0; left:0; width:100%; height:100%;
        background: rgba(0,0,0,0.8);
        z-index: 100;
        color: #fff;
        padding: 20px;
        overflow-y: scroll;
    }
    .modal.open { display: block; }
    .input-row { margin-bottom: 20px; border-bottom: 1px solid #555; padding-bottom: 10px;}
    input { width: 100%; margin-top: 5px; padding: 5px; }

</style>
</head>
<body>

    <button class="config-trigger" onclick="toggleConfig()">ğŸ”§ è¨­å®š</button>

    <div class="vending-machine">
        <div class="display-case">
            <div class="shelf">
                <div class="product-slot" id="slot-left">
                    <div class="back-light"></div>
                    <img src="https://via.placeholder.com/150x250/333/FFF?text=COFFEE" class="can-image" id="img-left">
                    <div class="price-tag">120</div>
                    <div class="product-name" id="name-left">å¾®ç³–ã‚³ãƒ¼ãƒ’ãƒ¼</div>
                </div>
                <div class="product-slot" id="slot-right">
                    <div class="back-light"></div>
                    <img src="https://via.placeholder.com/150x250/333/FFF?text=TEA" class="can-image" id="img-right">
                    <div class="price-tag">120</div>
                    <div class="product-name" id="name-right">ãƒŸãƒ«ã‚¯ãƒ†ã‚£ãƒ¼</div>
                </div>
            </div>
        </div>

        <div class="control-panel">
            <div class="machine-btn" id="btn-left">
                <div class="btn-lamp"></div>
            </div>
            <div class="machine-btn" id="btn-right">
                <div class="btn-lamp"></div>
            </div>
        </div>

        <div class="dispenser-port">
            <div class="dispenser-flap"></div>
            <div class="dropped-item" id="drop-container">
                <img src="" id="drop-img">
            </div>
        </div>
    </div>

    <div class="modal" id="config-modal">
        <h2>å•†å“è¨­å®š</h2>
        <div class="input-row">
            <h3>å·¦ã®ãƒœã‚¿ãƒ³</h3>
            <input type="text" id="conf-name-left" value="å¾®ç³–ã‚³ãƒ¼ãƒ’ãƒ¼">
            <input type="text" id="conf-url-left" placeholder="ç”»åƒURL">
            <input type="file" id="conf-file-left" accept="image/*">
        </div>
        <div class="input-row">
            <h3>å³ã®ãƒœã‚¿ãƒ³</h3>
            <input type="text" id="conf-name-right" value="ãƒŸãƒ«ã‚¯ãƒ†ã‚£ãƒ¼">
            <input type="text" id="conf-url-right" placeholder="ç”»åƒURL">
            <input type="file" id="conf-file-right" accept="image/*">
        </div>
        <button onclick="saveConfig()" style="padding:10px 20px; background:#e74c3c; color:white; border:none; border-radius:5px;">é–‰ã˜ã‚‹</button>
    </div>

<script>
    // çŠ¶æ…‹ç®¡ç†
    const state = {
        leftPressed: false,
        rightPressed: false,
        processing: false,
        timer: null
    };

    // DOMè¦ç´ 
    const els = {
        left: {
            btn: document.getElementById('btn-left'),
            slot: document.getElementById('slot-left'),
            img: document.getElementById('img-left'),
            name: document.getElementById('name-left')
        },
        right: {
            btn: document.getElementById('btn-right'),
            slot: document.getElementById('slot-right'),
            img: document.getElementById('img-right'),
            name: document.getElementById('name-right')
        },
        dropContainer: document.getElementById('drop-container'),
        dropImg: document.getElementById('drop-img')
    };

    // åˆæœŸåŒ–ï¼šå•†å“ã¯ç‚¹ç¯çŠ¶æ…‹ã«ã™ã‚‹ï¼ˆå¾…æ©Ÿä¸­ï¼‰
    els.left.slot.classList.add('lit');
    els.right.slot.classList.add('lit');
    els.left.btn.classList.add('lit');
    els.right.btn.classList.add('lit');

    // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆã®è¨­å®š
    setupTouch(els.left.btn, 'left');
    setupTouch(els.right.btn, 'right');

    function setupTouch(element, side) {
        element.addEventListener('touchstart', (e) => {
            e.preventDefault();
            handlePress(side);
        }, { passive: false });
    }

    // ãƒœã‚¿ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
    function handlePress(side) {
        if (state.processing) return;

        // æŠ¼ã•ã‚ŒãŸãƒœã‚¿ãƒ³ã‚’å‡¹ã¾ã›ã‚‹
        els[side].btn.classList.add('pressed');
        if (side === 'left') state.leftPressed = true;
        if (side === 'right') state.rightPressed = true;

        // åŒæ™‚æŠ¼ã—åˆ¤å®š (0.15ç§’ã®çŒ¶äºˆ)
        if (state.leftPressed && state.rightPressed) {
            clearTimeout(state.timer);
            startRoulette(); // â˜…ä¸¡æ–¹æŠ¼ã—æ¼”å‡ºé–‹å§‹
        } else {
            state.timer = setTimeout(() => {
                // æ™‚é–“åˆ‡ã‚Œï¼å˜æŠ¼ã—ç¢ºå®š
                if (state.leftPressed && !state.rightPressed) {
                    dispense('left');
                } else if (!state.leftPressed && state.rightPressed) {
                    dispense('right');
                }
                resetButtons();
            }, 150);
        }
    }

    function resetButtons() {
        state.leftPressed = false;
        state.rightPressed = false;
        els.left.btn.classList.remove('pressed');
        els.right.btn.classList.remove('pressed');
    }

    // â˜…ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆæ¼”å‡ºï¼ˆã“ã“ãŒãƒ¯ã‚¯ãƒ¯ã‚¯ãƒã‚¤ãƒ³ãƒˆï¼‰
    function startRoulette() {
        if(state.processing) return;
        state.processing = true;
        resetButtons(); // å‡¹ã¿ã¯æˆ»ã™

        // ä¸€æ—¦ä¸¡æ–¹æ¶ˆç¯
        lightControl('all', false);

        let count = 0;
        let speed = 100; // ç‚¹æ»…é€Ÿåº¦
        let current = 'left';

        // é«˜é€Ÿç‚¹æ»…ãƒ«ãƒ¼ãƒ—
        const loop = () => {
            // äº¤äº’ã«ç‚¹ç¯
            if (current === 'left') {
                lightControl('left', true);
                lightControl('right', false);
                current = 'right';
            } else {
                lightControl('left', false);
                lightControl('right', true);
                current = 'left';
            }

            count++;
            
            // 20å›ç‚¹æ»…ã—ãŸã‚‰æ±ºå®šãƒ•ã‚§ãƒ¼ã‚ºã¸
            if (count > 20) {
                // ãƒ©ãƒ³ãƒ€ãƒ æ±ºå®š
                const winner = Math.random() < 0.5 ? 'left' : 'right';
                finishRoulette(winner);
            } else {
                // é€Ÿåº¦ã‚’å°‘ã—ãšã¤è½ã¨ã™ï¼ˆãƒ‰ãƒ©ãƒ ãƒ­ãƒ¼ãƒ«æ„Ÿï¼‰
                if(count > 15) speed += 30;
                setTimeout(loop, speed);
            }
        };

        loop();
    }

    // ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆçµ‚äº†å‡¦ç†
    function finishRoulette(winner) {
        // å‹ã£ãŸæ–¹ã‚’å¼·ãç‚¹ç¯ã€è² ã‘ãŸæ–¹ã¯æ¶ˆç¯
        lightControl('left', false);
        lightControl('right', false);
        
        // å°‘ã—æºœã‚ã¦ã‹ã‚‰â€¦
        setTimeout(() => {
            lightControl(winner, true); // ãƒ”ã‚«ãƒ¼ãƒƒï¼
            dropItem(els[winner].img.src);
        }, 300);
    }

    // é€šå¸¸æ’å‡ºï¼ˆå˜æŠ¼ã—ï¼‰
    function dispense(side) {
        if(state.processing) return;
        state.processing = true;

        // é¸ã‚“ã æ–¹ã ã‘ç‚¹ç¯ã‚’æ®‹ã™
        lightControl('left', false);
        lightControl('right', false);
        lightControl(side, true);

        // ã‚¬ã‚³ãƒ³ï¼
        setTimeout(() => {
            dropItem(els[side].img.src);
        }, 200);
    }

    // ç…§æ˜ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
    function lightControl(side, isOn) {
        if (side === 'all') {
            lightControl('left', isOn);
            lightControl('right', isOn);
            return;
        }
        if (isOn) {
            els[side].slot.classList.add('lit');
            els[side].btn.classList.add('lit');
        } else {
            els[side].slot.classList.remove('lit');
            els[side].btn.classList.remove('lit');
        }
    }

    // å•†å“è½ä¸‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    function dropItem(src) {
        els.dropImg.src = src;
        
        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒªã‚»ãƒƒãƒˆ
        els.dropContainer.classList.remove('drop');
        void els.dropContainer.offsetWidth; // ãƒªãƒ•ãƒ­ãƒ¼
        
        // è½ä¸‹é–‹å§‹
        els.dropContainer.classList.add('drop');

        // å¾©å¸°å‡¦ç†
        setTimeout(() => {
            state.processing = false;
            // å¾…æ©ŸçŠ¶æ…‹ã«æˆ»ã™ï¼ˆä¸¡æ–¹ç‚¹ç¯ï¼‰
            lightControl('all', true);
        }, 2000);
    }

    // --- è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£ ---
    function toggleConfig() {
        document.getElementById('config-modal').classList.toggle('open');
    }
    
    function saveConfig() {
        updateData('left');
        updateData('right');
        toggleConfig();
    }

    function updateData(side) {
        // åå‰
        els[side].name.innerText = document.getElementById(`conf-name-${side}`).value;
        // ç”»åƒ
        const url = document.getElementById(`conf-url-${side}`).value;
        const file = document.getElementById(`conf-file-${side}`).files[0];
        if (url) els[side].img.src = url;
        else if (file) {
            const r = new FileReader();
            r.onload = e => els[side].img.src = e.target.result;
            r.readAsDataURL(file);
        }
    }
</script>
</body>
</html>
